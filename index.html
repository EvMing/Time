<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å¦¹å¦¹ä¸“å±æ—¥å†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.2/lunar.min.js" defer></script>
  <style>
    body {
      font-family: "Arial", sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
      background: linear-gradient(to bottom right, #f0f4ff, #ffffff);
    }
    h2 {
      margin-top: 20px;
      color: #2c3e50;
    }
    .time-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px auto;
      flex-wrap: wrap;
    }
    .clock {
      background: #ffffff;
      border-radius: 12px;
      padding: 15px 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      font-size: 14px;
      min-width: 180px;
      transition: all 0.3s;
      border-top: 5px solid #4a90e2;
    }
    .clock-time {
      font-size: 28px;
      font-weight: bold;
      margin-top: 5px;
    }
    .weather-main {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .weather-temp {
      font-size: 32px;
      font-weight: bold;
      color: #e91e63;
      margin: 5px 0;
    }
    .weather-desc-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 5px 0;
    }
    .chinese-desc-with-icon {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    .chinese-desc {
      font-weight: bold;
      font-size: 18px;
    }
    .english-desc {
      font-style: italic;
      color: #666;
      font-size: 14px;
    }
    .weather-icon {
        font-size: 24px; /* è°ƒæ•´å›¾æ ‡å¤§å° */
        width: 40px;
        height: 40px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .weather-wind {
      font-size: 14px;
      margin-top: 10px;
    }
    #beijing-time .clock-time { color: #007bff; }
    #edinburgh-time .clock-time { color: #e91e63; }

    #calendar-section {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin: 20px auto;
      max-width: 1000px;
      gap: 20px;
    }

    #photo-carousel {
      width: 300px;
      aspect-ratio: 1/1;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    #photo-carousel img {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain; /* â† è®©å›¾ç‰‡å®Œæ•´æ˜¾ç¤º */
      display: none;
    }

    #photo-carousel img.active {
      display: block;
    }

    #calendar {
      background: white;
      max-width: 700px;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      width: 14.2%;
      padding: 8px;
      text-align: center;
      border: 1px solid #e0e0e0;
      vertical-align: top;
    }
    th { background-color: #f8f9fa; color: #333; font-weight: 600; font-family: 'Helvetica Neue', sans-serif; }
    .beijing { background-color: #d7eaff; }
    .edinburgh { background-color: #ffe1eb; }
    .both { background: linear-gradient(to right, #ffe1eb 50%, #d7eaff 50%); }
    .today { font-weight: bold; background-color: #ffe1eb; }
    .festival, .custom, .lunar, .jieqi, .oneoff {
      font-size: 10px;
      display: block;
      margin-top: 2px;
      font-family: "Arial", sans-serif;
    }
    .festival { color: #3f51b5; font-weight: bold; }
    .custom { color: #d81b60; font-style: bold; }
    .custom::before { content: "â¤ï¸ "; }
    .oneoff { color: #e74c3c; font-style: bold; }
    .oneoff::before { content: "â­ "; }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      align-items: center;
    }
    .nav-buttons h3 {
      margin: 0;
      font-weight: 500;
      color: #2c3e50;
      font-family: 'Segoe UI', sans-serif;
    }
    button {
      padding: 6px 10px;
      border: none;
      border-radius: 5px;
      background-color: #4a90e2;
      color: white;
      cursor: pointer;
      font-size: 20px;
    }
    button:hover { background-color: #357abd; }
    .custom-date { color: #d81b60; }
    .oneoff-date { color: #e74c3c; }
  </style>
</head>
<body>
  <h2>å¦¹å¦¹è¯»åšä¸€åˆ‡é¡ºåˆ©</h2>
  <div class="time-container">
    <div class="clock" id="beijing-time"></div>
    <div class="clock" id="edinburgh-time"></div>
    <div class="clock" id="weather">
        <div class="weather-main">
          <div class="weather-temp">--Â°C</div>
          <div class="weather-desc-container">
            <div class="chinese-desc-with-icon">
              <div class="chinese-desc">åŠ è½½ä¸­...</div>
              <div class="weather-icon" id="weather-icon"></div>
              <div class="weather-wind"></div>
            </div>
          </div>
          
        </div>
    </div>
  </div>
  <div id="calendar-section">
    <div id="photo-carousel"></div>
    <div id="calendar"></div>
  </div>
  <script>
    const festivals = { "10-01": "å›½åº†èŠ‚", "02-14": "æƒ…äººèŠ‚", "05-20": "çˆ±ä½ â¤ï¸"};
    const customDatesEveryYear = { "06-01": "å“¥å“¥ç”Ÿæ—¥", "09-11": "å¦¹å¦¹ç”Ÿæ—¥" };
    const customDatesOneTime = { "2025-11-28": "åœ¨ä¸€èµ·5å¹´å•¦!!", "2026-11-28": "åœ¨ä¸€èµ·6å¹´å•¦!!", "2026-05-21": "åœ¨ä¸€èµ·2000å¤©å’¯!!", "2027-11-28": "åœ¨ä¸€èµ·7å¹´å•¦!!"};

    const allPhotos = [
      "https://evming.github.io/Time/images/1-1.jpg", "https://evming.github.io/Time/images/1-2.jpg", "https://evming.github.io/Time/images/1-3.jpg", "https://evming.github.io/Time/images/1-4.jpg", "https://evming.github.io/Time/images/1-5.jpg", "https://evming.github.io/Time/images/1-6.jpg",
      "https://evming.github.io/Time/images/2-1.jpg", "https://evming.github.io/Time/images/2-2.jpg", "https://evming.github.io/Time/images/2-3.jpg", "https://evming.github.io/Time/images/2-4.jpg", "https://evming.github.io/Time/images/2-5.jpg", "https://evming.github.io/Time/images/2-6.jpg", "https://evming.github.io/Time/images/2-7.jpg",
      "https://evming.github.io/Time/images/3-1.jpg", "https://evming.github.io/Time/images/3-2.jpg", "https://evming.github.io/Time/images/3-3.jpg", "https://evming.github.io/Time/images/3-4.jpg", "https://evming.github.io/Time/images/3-5.jpg", "https://evming.github.io/Time/images/3-6.jpg",
      "https://evming.github.io/Time/images/4-1.jpg", "https://evming.github.io/Time/images/4-2.jpg", "https://evming.github.io/Time/images/4-3.jpg", "https://evming.github.io/Time/images/4-4.jpg", "https://evming.github.io/Time/images/4-5.jpg", "https://evming.github.io/Time/images/4-6.jpg",
      "https://evming.github.io/Time/images/5-1.jpg", "https://evming.github.io/Time/images/5-2.jpg", "https://evming.github.io/Time/images/5-3.jpg", "https://evming.github.io/Time/images/5-4.jpg", "https://evming.github.io/Time/images/5-5.jpg", "https://evming.github.io/Time/images/5-6.jpg", "https://evming.github.io/Time/images/5-7.jpg",
      "https://evming.github.io/Time/images/6-1.jpg", "https://evming.github.io/Time/images/6-2.jpg", "https://evming.github.io/Time/images/6-3.jpg", "https://evming.github.io/Time/images/6-4.jpg", "https://evming.github.io/Time/images/6-5.jpg", "https://evming.github.io/Time/images/6-6.jpg", "https://evming.github.io/Time/images/6-7.jpg", "https://evming.github.io/Time/images/6-8.jpg", "https://evming.github.io/Time/images/6-9.jpg", "https://evming.github.io/Time/images/6-10.jpg", "https://evming.github.io/Time/images/6-11.jpg", "https://evming.github.io/Time/images/6-12.jpg", "https://evming.github.io/Time/images/6-13.jpg", "https://evming.github.io/Time/images/6-14.jpg","https://evming.github.io/Time/images/6-15.jpg", "https://evming.github.io/Time/images/6-16.jpg", "https://evming.github.io/Time/images/6-17.jpg", "https://evming.github.io/Time/images/6-18.jpg", "https://evming.github.io/Time/images/6-19.jpg", "https://evming.github.io/Time/images/6-20.jpg", "https://evming.github.io/Time/images/6-21.jpg", "https://evming.github.io/Time/images/6-22.jpg", "https://evming.github.io/Time/images/6-23.jpg", "https://evming.github.io/Time/images/6-24.jpg", "https://evming.github.io/Time/images/6-25.jpg", "https://evming.github.io/Time/images/6-26.jpg", "https://evming.github.io/Time/images/6-27.jpg",
      "https://evming.github.io/Time/images/7-1.jpg", "https://evming.github.io/Time/images/7-2.jpg", "https://evming.github.io/Time/images/7-3.jpg", "https://evming.github.io/Time/images/7-4.jpg", 
    ];

    // å¤©æ°”æè¿°ç¿»è¯‘æ˜ å°„
    const weatherTranslations = {
      "clear sky": "æ™´æœ—",
      "few clouds": "å°‘äº‘",
      "scattered clouds": "æ•£äº‘",
      "broken clouds": "å¤šäº‘",
      "overcast clouds": "é˜´å¤©",
      "light rain": "å°é›¨",
      "moderate rain": "ä¸­é›¨",
      "heavy intensity rain": "å¤§é›¨",
      "very heavy rain": "æš´é›¨",
      "extreme rain": "æç«¯é™é›¨â—â—",
      "freezing rain": "å†»é›¨",
      "light intensity shower rain": "å°é˜µé›¨",
      "shower rain": "é˜µé›¨",
      "heavy intensity shower rain": "å¼ºé˜µé›¨â—",
      "ragged shower rain": "é›¶æ˜Ÿé˜µé›¨",
      "light snow": "å°é›ª",
      "snow": "é›ª",
      "heavy snow": "å¤§é›ª",
      "sleet": "é›¨å¤¹é›ª",
      "light shower sleet": "å°é˜µé›¨å¤¹é›ª",
      "shower sleet": "é˜µé›¨å¤¹é›ª",
      "light rain and snow": "å°é›¨é›ª",
      "rain and snow": "é›¨é›ª",
      "light shower snow": "å°é˜µé›ª",
      "shower snow": "é˜µé›ª",
      "heavy shower snow": "å¼ºé˜µé›ªâ—",
      "mist": "è–„é›¾",
      "smoke": "çƒŸé›¾",
      "haze": "éœ¾",
      "sand/dust whirls": "æ²™å°˜æ—‹é£",
      "fog": "é›¾",
      "sand": "æ²™å°˜",
      "dust": "ç°å°˜",
      "volcanic ash": "ç«å±±ç°",
      "squalls": "ç‹‚é£â—",
      "tornado": "é¾™å·é£â—",
      "thunderstorm with light rain": "é›·é˜µå°é›¨",
      "thunderstorm with rain": "é›·é˜µé›¨",
      "thunderstorm with heavy rain": "é›·é˜µå¤§é›¨",
      "light thunderstorm": "è½»é›·æš´",
      "thunderstorm": "é›·æš´",
      "heavy thunderstorm": "å¼ºé›·æš´â—â—",
      "ragged thunderstorm": "é›¶æ˜Ÿé›·æš´",
      "thunderstorm with light drizzle": "é›·é˜µæ¯›æ¯›é›¨",
      "thunderstorm with drizzle": "é›·é˜µæ¯›æ¯›é›¨",
      "thunderstorm with heavy drizzle": "é›·é˜µå¼ºæ¯›æ¯›é›¨"
    };
    // å¤©æ°”å›¾æ ‡æ˜ å°„ - ä½¿ç”¨Emojiä½œä¸ºç®€å•æ–¹æ¡ˆ
    const weatherIcons = {
      "clear sky": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204335.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204355.png"
    }, 
      "few clouds": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204336.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204359.png"
    },
      "scattered clouds": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204336.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204359.png" 
    },
      "broken clouds": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204336.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204359.png" 
    },
      "overcast clouds": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750201.png",
        night: "https://evming.github.io/Time/images/WeatherImg/3750201.png"
    },
      "light rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204429.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204416.png"
    },
      "moderate rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204337.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/2204361.png"
    },
      "heavy intensity rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204338.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204338.png"
    },
      "very heavy rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204339.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204411.png"
    },
      "extreme rain": {
        day:"https://evming.github.io/Time/images/WeatherImg/2204340.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204419.png"
    },
      "freezing rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204374.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204374.png"
    },
      "light intensity shower rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750491.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204361.png"
    },
      "shower rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204450.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204450.png"
    },
      "heavy intensity shower rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204337.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/2204361.png"
    },
      "ragged shower rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204337.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/2204361.png"
    },
      "light snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750415.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204440.png"
    },
      "snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204374.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204371.png"
    },
      "heavy snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204370.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/2204397.png"
      },
      "sleet": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204342.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/3750467.png"
      },
      "light shower sleet": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204342.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/3750467.png"
      },
      "shower sleet": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204342.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/3750467.png"
      },
      "light rain and snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204342.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/3750467.png"
      },
      "rain and snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204342.png", 
        night: "https://evming.github.io/Time/images/WeatherImg/3750467.png"
      },
      "light shower snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204343.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204371.png"
        },
      "shower snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204343.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204371.png"
        },
      "heavy shower snow": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204343.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204371.png"
        },
      "mist": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750480.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204353.png"
        },
      "smoke": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750480.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204353.png"
        },
      "haze": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750480.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204353.png"
        },
      "sand/dust whirls": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204426.png",
        night:"https://evming.github.io/Time/images/WeatherImg/3750668.png"
        },
      "fog": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750480.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204353.png"
        },
      "sand": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750480.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204353.png"
        },
      "dust": {
        day: "https://evming.github.io/Time/images/WeatherImg/3750480.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204353.png"
        },
      "volcanic ash": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204436.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204436.png"    
    },
      "squalls": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204344.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204382.png"
    },
      "tornado": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204426.png",
        night:"https://evming.github.io/Time/images/WeatherImg/3750668.png"
        },
      "thunderstorm with light rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204423.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204341.png"
    },
      "thunderstorm with rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204340.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204340.png"
    },
      "thunderstorm with heavy rain": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204340.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204340.png"
    },
      "light thunderstorm": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204423.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204341.png"
    },
      "thunderstorm": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204423.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204341.png"
    },
      "heavy thunderstorm": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204423.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204341.png"
    },
      "ragged thunderstorm": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204423.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204341.png"
    },
      "thunderstorm with light drizzle": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204408.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204411.png"
    },
      "thunderstorm with drizzle": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204450.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204385.png"
    },
      "thunderstorm with heavy drizzle": {
        day: "https://evming.github.io/Time/images/WeatherImg/2204450.png",
        night: "https://evming.github.io/Time/images/WeatherImg/2204387.png"
    }
    };

    // é£é€Ÿç­‰çº§è½¬æ¢å‡½æ•°
    function getWindLevel(speed) {
      if (speed < 0.3) return "æ— é£";
      else if (speed < 1.6) return "ä¸€çº§";
      else if (speed < 3.4) return "äºŒçº§";
      else if (speed < 5.5) return "ä¸‰çº§";
      else if (speed < 8.0) return "å››çº§";
      else if (speed < 10.8) return "äº”çº§";
      else if (speed < 13.9) return "å…­çº§";
      else if (speed < 17.2) return "ä¸ƒçº§";
      else if (speed < 20.8) return "å…«çº§";
      else if (speed < 24.5) return "ä¹çº§";
      else if (speed < 28.5) return "åçº§";
      else if (speed < 32.7) return "åä¸€çº§";
      else return "åäºŒçº§";
    }

    // åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºç™½å¤©ï¼ˆçˆ±ä¸å ¡æ—¶é—´ï¼‰
    function isDayTime() {
        const nowED = new Date(new Date().toLocaleString("en-US", { timeZone: "Europe/London" }));
        const hour = nowED.getHours();
        // å‡è®¾6:00-18:00ä¸ºç™½å¤©
        return hour >= 6 && hour < 18;
    }

    let currentDate = new Date();
    let photoInterval = null;

    function updateTime() {
      const nowBJ = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Shanghai" }));
      const nowED = new Date(new Date().toLocaleString("en-US", { timeZone: "Europe/London" }));
      document.getElementById("beijing-time").innerHTML = `åŒ—äº¬<br><span class='clock-time'>${nowBJ.toLocaleTimeString()}</span><br>${nowBJ.toLocaleDateString()}`;
      document.getElementById("edinburgh-time").innerHTML = `çˆ±ä¸å ¡<br><span class='clock-time'>${nowED.toLocaleTimeString()}</span><br>${nowED.toLocaleDateString()}`;
    }
    setInterval(updateTime, 1000);
    updateTime();

    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      createCalendar(currentDate);
    }

    function createCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
      

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDay = firstDay.getDay();

        let html = `
        <div class="nav-buttons">
            <button onclick="changeMonth(-1)">â†</button>
            <h3>${year}å¹´ ${month + 1}æœˆ</h3>
            <button onclick="changeMonth(1)">â†’</button>
        </div>
        <table><tr><th>æ—¥</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th></tr><tr>`;

        let day = 1;
        for (let i = 0; i < 6; i++) {
        for (let j = 0; j < 7; j++) {
            if ((i === 0 && j < startDay) || day > lastDay.getDate()) {
            html += "<td></td>";
            } else {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const mmdd = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            let cls = "", info = "", style = "";
            // const today = new Date();
            const today = new Date(new Date().toLocaleString("en-US", { timeZone: "Europe/London" }));
            if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                cls += " today";
            }

            let showLunar = true;
            if (customDatesEveryYear[mmdd]) {
                info += `<span class='custom'>${customDatesEveryYear[mmdd]}</span>`;
                style += "color:#d81b60;";
                showLunar = false;
            }
            if (customDatesOneTime[dateStr]) {
                info += `<span class='oneoff'>${customDatesOneTime[dateStr]}</span>`;
                style += "color:#e74c3c;";
                showLunar = false;
            }

            const lunar = Lunar.fromDate(new Date(year, month, day));
            if (lunar.getJieQi()) {
                info += `<span class='jieqi'>${lunar.getJieQi()}</span>`;
                showLunar = false;
            }

            if (festivals[mmdd]) {
                info += `<span class='festival'>${festivals[mmdd]}</span>`;
                showLunar = false;
            }

            if (showLunar) {
                info += `<span class='lunar'>${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()}</span>`;
            }

            const bjDate = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Shanghai" }));
            const edDate = new Date(new Date().toLocaleString("en-US", { timeZone: "Europe/London" }));
            if (bjDate.getMonth() === month && bjDate.getDate() === day && edDate.getDate() === day) {
                cls += " both";
            } else if (bjDate.getMonth() === month && bjDate.getDate() === day) {
                cls += " beijing";
            } else if (edDate.getMonth() === month && edDate.getDate() === day) {
                cls += " edinburgh";
            }

            html += `<td class="${cls}"><span style="${style}">${day}</span>${info}</td>`;
            day++;
            }
        }
        html += "</tr>";
        if (day > lastDay.getDate()) break;
        else html += "<tr>";
        }
        html += "</table>";
        document.getElementById("calendar").innerHTML = html;
        // updateCarousel(month);
    }

    // åˆå§‹åŒ–ç…§ç‰‡è½®æ’­ï¼ˆåªæœ‰ä¸€ç»„ï¼‰
    function initCarousel() {
      const container = document.getElementById("photo-carousel");
      container.innerHTML = "";
      if (photoInterval) clearInterval(photoInterval);
      
      allPhotos.forEach((src, i) => {
        const img = document.createElement("img");
        img.src = src;
        if (i === 0) img.classList.add("active");
        container.appendChild(img);
      });
      
      const imgs = container.querySelectorAll("img");
      let index = 0;
      if (imgs.length > 1) {
        photoInterval = setInterval(() => {
          imgs[index].classList.remove("active");
          index = (index + 1) % imgs.length;
          imgs[index].classList.add("active");
        }, 5000);
      }
    }

    // è·å–çˆ±ä¸å ¡å¤©æ°”
    async function getEdinburghWeather() {
      try {
        // ä½¿ç”¨OpenWeatherMap APIï¼Œæ‚¨éœ€è¦æ›¿æ¢ä¸ºæ‚¨çš„API key
        const apiKey = '37161220b03978db48f81116e50c9714'; // è¯·æ›¿æ¢ä¸ºå®é™…çš„API key
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Edinburgh,UK&units=metric&appid=${apiKey}`);
        
        if (!response.ok) {
          throw new Error('å¤©æ°”æ•°æ®è·å–å¤±è´¥');
        }
        
        const data = await response.json();
        
        // ç¿»è¯‘å¤©æ°”æè¿°
        const englishDesc = data.weather[0].description;
        const chineseDesc = weatherTranslations[englishDesc] || englishDesc;
        

        // åˆ¤æ–­ç™½å¤©è¿˜æ˜¯å¤œæ™š
        const isDay = isDayTime();
        
        // è·å–å¤©æ°”å›¾æ ‡ï¼ˆæ ¹æ®ç™½å¤©/å¤œæ™šï¼‰
        // ä½¿ç”¨çœŸå®å›¾ç‰‡
        if (weatherIcons[englishDesc]) {
            weatherIcon = isDay ? weatherIcons[englishDesc].day : weatherIcons[englishDesc].night;
            document.getElementById('weather-icon').style.backgroundImage = `url(${weatherIcon})`;
            document.getElementById('weather-icon').textContent = '';
        } else {
            // é»˜è®¤ä½¿ç”¨Emoji
            weatherIcon = isDay ? "â›…" : "ğŸŒ™";
            document.getElementById('weather-icon').textContent = weatherIcon;
            document.getElementById('weather-icon').style.backgroundImage = '';
        }
        // è·å–å¤©æ°”å›¾æ ‡

        // const weatherIcon = weatherIcons[englishDesc] || "â›…";
        
        // è½¬æ¢é£é€Ÿç­‰çº§
        const windLevel = getWindLevel(data.wind.speed);
        
        // æ›´æ–°å¤©æ°”ä¿¡æ¯
        document.querySelector('.weather-temp').textContent = `${Math.round(data.main.temp)}Â°C`;
        document.querySelector('.chinese-desc').textContent = chineseDesc;
        // document.querySelector('.english-desc').textContent = englishDesc;
        document.querySelector('.weather-wind').textContent = `é£é€Ÿ: ${windLevel}`;
        // document.getElementById('weather-icon').style.backgroundImage = `url(${weatherIcon})`;
        // document.getElementById('weather-icon').textContent = '';

          
      } catch (error) {
        console.error('è·å–å¤©æ°”æ•°æ®å¤±è´¥:', error);
        document.querySelector('.chinese-desc').textContent = 'å¤©æ°”æ•°æ®æš‚æ—¶ä¸å¯ç”¨';
        document.querySelector('.english-desc').textContent = 'Weather data unavailable';
        document.getElementById('weather-icon').textContent = 'â“';
      }
    }

    // function updateCarousel(monthIndex) {
    //   const container = document.getElementById("photo-carousel");
    //   container.innerHTML = "";
    //   if (photoInterval) clearInterval(photoInterval);
    //   const photos = photoGroups[monthIndex] || [];
    //   photos.forEach((src, i) => {
    //     const img = document.createElement("img");
    //     img.src = src;
    //     if (i === 0) img.classList.add("active");
    //     container.appendChild(img);
    //   });
    //   const imgs = container.querySelectorAll("img");
    //   let index = 0;
    //   if (imgs.length > 1) {
    //     photoInterval = setInterval(() => {
    //       imgs[index].classList.remove("active");
    //       index = (index + 1) % imgs.length;
    //       imgs[index].classList.add("active");
    //     }, 10000);
    //   }
    // }

    window.addEventListener("DOMContentLoaded", () => {
      createCalendar(currentDate);
      initCarousel(); // åˆå§‹åŒ–ç…§ç‰‡è½®æ’­
      getEdinburghWeather(); // è·å–å¤©æ°”ä¿¡æ¯

      // æ¯30åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å¤©æ°”
      setInterval(getEdinburghWeather, 30 * 60 * 1000);
      let refreshedBJ = false;
      let refreshedED = false;
      setInterval(() => {
        const nowBJ = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Shanghai" }));
        const nowED = new Date(new Date().toLocaleString("en-US", { timeZone: "Europe/London" }));

        if (nowBJ.getHours() === 0 && nowBJ.getMinutes() === 0 && nowBJ.getSeconds() < 2 && !refreshedBJ) {
          refreshedBJ = true;
          location.reload();
        }
        if (nowED.getHours() === 0 && nowED.getMinutes() === 0 && nowED.getSeconds() < 2 && !refreshedED) {
          refreshedED = true;
          location.reload();
        }

        // é‡ç½®æ ‡å¿—ä»¥ä¾¿ç¬¬äºŒå¤©å¯å†æ¬¡åˆ·æ–°
        if (nowBJ.getHours() === 1 && refreshedBJ) refreshedBJ = false;
        if (nowED.getHours() === 1 && refreshedED) refreshedED = false;
      }, 1000);
    });
  </script>
</body>
</html>

